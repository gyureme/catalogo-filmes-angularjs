<!DOCTYPE html>
<html lang="pt-BR" ng-app="movieCatalog">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movies Flix</title>
  <!-- AngularJS + ngRoute via CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular-route.min.js"></script>

  <style>
    :root { --bg:#0f1220; --card:#161a2e; --muted:#9aa0b4; --text:#e8ecf8; --accent:#5ad1ff; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:var(--bg); color:var(--text)}
    header{padding:24px 16px; border-bottom:1px solid #22263f}
    .container{max-width:1100px; margin:0 auto; padding:16px}
    h1{color:rgb(170, 170, 170);  margin:0; font-size:24px}
    .controls{display:grid; gap:12px; grid-template-columns: 1fr 160px 140px 120px}
    .controls > *{background:var(--card); color:var(--text); border:1px solid #22263f; padding:10px 12px; border-radius:12px}
    .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:16px; margin-top:16px}
    .card{background:var(--card); border:1px solid #22263f; border-radius:16px; overflow:hidden; display:flex; flex-direction:column}
    .poster{width:100%; aspect-ratio:2/3; object-fit:cover; background:#0b0e1a}
    .card-body{padding:12px}
    .title{font-weight:600; font-size:14px; line-height:1.3; margin:0 0 6px}
    .meta{font-size:12px; color:var(--muted); display:flex; gap:8px; align-items:center}
    .badge{font-size:11px; background:#1d2242; padding:2px 6px; border-radius:999px; border:1px solid #2a3162}
    .btn{display:inline-block; text-decoration:none; color:var(--bg); background:var(--accent); border:none; padding:8px 12px; border-radius:10px; font-weight:600; margin-top:10px}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .pagination{display:flex; gap:8px; align-items:center; margin-top:16px}
    .page-btn{padding:8px 12px; border-radius:10px; border:1px solid #22263f; background:var(--card); color:var(--text)}
    .page-btn[disabled]{opacity:.5; cursor:not-allowed}
    a.title-link{color:var(--text); text-decoration:none}
    a.title-link:hover{color:var(--accent)}
    .back{color:var(--accent); text-decoration:none}
    @media (max-width:700px){ .controls{grid-template-columns:1fr 1fr; } }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <h1>Movies Flix</h1>
    </div>
  </header>

  <main class="container">
    <!-- ngView injeta as rotas -->
    <div ng-view></div>
  </main>

  <script>
  // ==== App e Rotas ====
  angular.module('movieCatalog', ['ngRoute'])
    .config(function($routeProvider, $locationProvider){
      $routeProvider
        .when('/', {
          templateUrl: 'list.html',
          controller: 'ListController'
        })
        .when('/movie/:id', {
          templateUrl: 'detail.html',
          controller: 'DetailController'
        })
        .otherwise({redirectTo:'/'});
      // $locationProvider.html5Mode(true); // opcional
    })

    // ==== Filtro para paginação ====
    .filter('startFrom', function(){
      return function(input, start){
        if(!input) return [];
        start = +start;
        return input.slice(start);
      }
    })

    // ==== Service com mock de filmes ====
    .factory('MovieService', function($q, $timeout){
      var movies = [
        { id:1, title:'A origem', year:2010, rating:8.8, genres:['Sci-Fi','Thriller'],
          poster:'img/inception.jpg',
          overview:'Um ladrão invade sonhos para roubar segredos, mas recebe uma missão inversa: plantar uma ideia.' },
        { id:2, title:'Interestelar', year:2014, rating:8.6, genres:['Sci-Fi','Drama'],
          poster:'img/interestellart.jpg',
          overview:'Exploradores viajam por um buraco de minhoca para salvar a humanidade.' },
        { id:3, title:'Batman o caveleiro das trevas', year:2008, rating:9.0, genres:['Action','Crime'],
          poster:'img/batman.jpg',
          overview:'Batman enfrenta o Coringa enquanto Gotham mergulha no caos.' },
        { id:4, title:'A viagem de Chihiro', year:2001, rating:8.6, genres:['Animation','Fantasy'],
          poster:'img/chihiro.jpg',
          overview:'Chihiro entra num mundo de espíritos e precisa libertar seus pais.' },
        { id:5, title:'Parasita', year:2019, rating:8.5, genres:['Drama','Thriller'],
          poster:'img/parasite.JPG',
          overview:'Duas famílias se entrelaçam numa sátira social imprevisível.' },
        { id:6, title:'Tomates verdes e fritos', year:1992, rating:7.7, genres:['Drama','Music'],
          poster:'img/tomatesverdes.jpg',
          overview:'Evelyn Couch visita um parente em um lar de repouso para idosos, e lá, encontra Ninny Threadgoode, uma senhora que a traz uma nova perspectiva através de contos do seu passado dando a Evelyn confiança para mudar sua própria vida para melhor.' },
        { id:7, title:'Hotel Transilvânia', year:2012, rating:7.0, genres:['Animation','Romance'],
          poster:'img/transilvania.jpg',
          overview:'O Hotel Transilvânia é um resort cinco estrelas que serve de refúgio para que os monstros possam descansar do árduo trabalho de perseguir e assustar os humanos.' },
        { id:8, title:'Matrix', year:1999, rating:8.7, genres:['Sci-Fi','Action'],
          poster:'img/thematrix.webp',
          overview:'Neo descobre a verdade sobre a realidade simulada.' },
        { id:9, title:'O poderoso chefão', year:1972, rating:9.2, genres:['Crime','Drama'],
          poster:'img/thegodfather.jpg',
          overview:'A ascensão da família Corleone no submundo de NY.' },
        { id:10, title:'Duna: Parte dois', year:2024, rating:8.6, genres:['Sci-Fi','Adventure'],
          poster:'img/dune.jpeg',
          overview:'Paul Atreides une os Fremen para desafiar o Império.' }
      ];

      // Simula async (como se fosse uma chamada HTTP)
      function delay(data){ return $q(function(resolve){ $timeout(function(){ resolve(angular.copy(data)); }, 200); }); }

      return {
        list: function(){ return delay(movies); },
        getById: function(id){
          var item = movies.find(m => m.id === Number(id));
          return delay(item || null);
        }
      };
    })

    // ==== Controller: Lista ====
    .controller('ListController', function($scope, MovieService, $filter){
      $scope.search = '';
      $scope.sortField = 'title';      // title | year | rating
      $scope.sortReverse = false;
      $scope.pageSize = 10;
      $scope.currentPage = 1;

      $scope.genres = [];          // preenchido após carregar
      $scope.genreFilter = '';     // gênero selecionado

      MovieService.list().then(function(items){
        $scope.movies = items;

        // gêneros únicos para filtro
        var set = new Set();
        items.forEach(m => (m.genres||[]).forEach(g => set.add(g)));
        $scope.genres = Array.from(set).sort();

        $scope.updateFiltered(); // inicial
      });

      $scope.updateFiltered = function(){
        var arr = $scope.movies || [];

        // filtro por busca em título + overview
        if($scope.search){
          var term = $scope.search.toLowerCase();
          arr = arr.filter(m =>
            (m.title||'').toLowerCase().includes(term) ||
            (m.overview||'').toLowerCase().includes(term)
          );
        }

        // filtro por gênero
        if($scope.genreFilter){
          arr = arr.filter(m => (m.genres||[]).includes($scope.genreFilter));
        }

        // ordenação
        arr = $filter('orderBy')(arr, $scope.sortField, $scope.sortReverse);

        $scope.filtered = arr;
        $scope.totalPages = Math.max(1, Math.ceil(arr.length / $scope.pageSize));
        if($scope.currentPage > $scope.totalPages) $scope.currentPage = $scope.totalPages;
      };

      $scope.$watchGroup(['search','sortField','sortReverse','genreFilter','pageSize'], function(){
        $scope.currentPage = 1; // reset ao mudar critérios
        $scope.updateFiltered();
      });

      $scope.pageStartIndex = function(){ return ($scope.currentPage - 1) * $scope.pageSize; };

      $scope.prev = function(){ if($scope.currentPage>1) $scope.currentPage--; };
      $scope.next = function(){ if($scope.currentPage<$scope.totalPages) $scope.currentPage++; };
    })

    // ==== Controller: Detalhe ====
    .controller('DetailController', function($scope, $routeParams, MovieService, $window){
      $scope.loading = true;
      MovieService.getById($routeParams.id).then(function(movie){
        $scope.movie = movie;
        $scope.loading = false;
      });
      $scope.goBack = function(){ $window.history.back(); };
    });
  </script>

  <!-- ===== Template: Lista ===== -->
  <script type="text/ng-template" id="list.html">
    <div class="controls">
      <input type="search" ng-model="search" placeholder="Buscar por título ou descrição..." aria-label="Busca" />
      <select ng-model="genreFilter">
        <option value="">Todos os gêneros</option>
        <option ng-repeat="g in genres" ng-value="g">{{g}}</option>
      </select>
      <select ng-model="sortField">
        <option value="title">Ordenar por: Título</option>
        <option value="year">Ordenar por: Ano</option>
        <option value="rating">Ordenar por: Nota</option>
      </select>
      <select ng-model="pageSize">
        <option ng-value="4">4 por página</option>
        <option ng-value="8">8 por página</option>
        <option ng-value="10">10 por página</option>
      </select>
    </div>

    <div class="grid">
      <div class="card" ng-repeat="m in filtered | startFrom:pageStartIndex() | limitTo:pageSize">
        <img class="poster" ng-src="{{m.poster}}" alt="Poster de {{m.title}}">
        <div class="card-body">
          <h3 class="title">
            <a class="title-link" href="#!/movie/{{m.id}}">{{m.title}}</a>
          </h3>
          <div class="meta">
            <span class="badge">{{m.year}}</span>
            <span class="badge">⭐ {{m.rating}}</span>
          </div>
          <p style="font-size:12px; color:var(--muted); margin-top:8px">{{m.overview}}</p>
          <a class="btn" href="#!/movie/{{m.id}}">Ver detalhes</a>
        </div>
      </div>
    </div>

    <div class="pagination" ng-if="filtered.length > pageSize">
      <button class="page-btn" ng-click="prev()" ng-disabled="currentPage===1">◀ Anterior</button>
      <span>Página {{currentPage}} de {{totalPages}}</span>
      <button class="page-btn" ng-click="next()" ng-disabled="currentPage===totalPages">Próxima ▶</button>
    </div>
  </script>

  <!-- ===== Template: Detalhe ===== -->
  <script type="text/ng-template" id="detail.html">
    <div ng-if="loading">Carregando...</div>
    <div ng-if="!loading && movie">
      <p><a class="back" href="" ng-click="goBack()">← Voltar</a></p>
      <div class="row">
        <img class="poster" ng-src="{{movie.poster}}" alt="Poster de {{movie.title}}" style="max-width:280px; border-radius:14px">
        <div style="min-width:260px">
          <h2 style="margin:0 0 6px">{{movie.title}}</h2>
          <div class="meta" style="margin-bottom:8px">
            <span class="badge">{{movie.year}}</span>
            <span class="badge">⭐ {{movie.rating}}</span>
            <span class="badge" ng-repeat="g in movie.genres">{{g}}</span>
          </div>
          <p style="color:var(--muted)">{{movie.overview}}</p>
        </div>
      </div>
    </div>
    <div ng-if="!loading && !movie">
      <p>Filme não encontrado.</p>
      <p><a class="back" href="#!/">← Voltar ao catálogo</a></p>
    </div>
  </script>

</body>
</html>
